<<<<<<< HEAD
var app = angular.module('informacionPresupuestariaController',['ngAnimate', 'ngTouch', 'ui.grid.edit', 'ui.grid.rowEdit']);

app.controller('adquisicionesController', ['$scope', '$http', '$interval', 'uiGridTreeViewConstants','Utilidades','i18nService','uiGridConstants','$timeout', 'uiGridTreeBaseService', '$q','dialogoConfirmacion',
	function($scope, $http, $interval, uiGridTreeViewConstants,$utilidades,i18nService,uiGridConstants,$timeout, uiGridTreeBaseService, $q, $dialogoConfirmacion){
		var mi = this;
		mi.gridOptions = {};
		mi.mostrarcargando=false;
		i18nService.setCurrentLang('es');
		mi.modificarTabla = true;
		mi.mostrarDescargar = false;
		mi.totalP = 0;
		mi.totales = [];
		mi.columnaNames = [];
		mi.informeCompleto = false;
		mi.categorias = [];
		mi.menuItems = [];
		mi.columnasDinamicas =[];
		
		var AGRUPACION_MES= 1;
		var AGRUPACION_BIMESTRE = 2;
		var AGRUPACION_TRIMESTRE = 3;
		var AGRUPACION_CUATRIMESTRE= 4;
		var AGRUPACION_SEMESTRE= 5;
		var AGRUPACION_ANUAL= 6;
		
		var MES_NAME = ['mes1','mes2','mes3','mes4','mes5','mes6','mes7','mes8','mes9','mes10','mes11','mes12'];
		var MES_DISPLAY_NAME = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
		var BIMESTRE_NAME = ['Bimestre1', 'Bimestre2', 'Bimestre3', 'Bimestre4', 'Bimestre5', 'Bimestre6'];
		var BIMESTRE_DISPLAY_NAME = ['Bimestre 1', 'Bimestre 2','Bimestre 3','Bimestre 4','Bimestre 5','Bimestre 6'];
		var TRIMESTRE_NAME = ['Trimestre1', 'Trimestre2','Trimestre3','Trimestre4'];
		var TRIMESTRE_DISPLAY_NAME = ['Trimestre 1', 'Trimestre 2', 'Trimestre 3', 'Trimestre 4'];
		var CUATRIMESTRE_NAME = ['Cuatrimestre1','Cuatrimestre2','Cuatrimestre3'];
		var CUATRIMESTRE_DISPLAY_NAME = ['Cuatrimestre 1', 'Cuatrimestre 2', 'Cuatrimestre 3'];
		var SEMESTRE_NAME = ['Semestre1','Semestre2'];
		var SEMESTRE_DISPLAY_NAME = ['Semestre 1','Semestre 2'];
		
		mi.agrupaciones = [
			{'value' : 0, 'text' : 'Seleccione una opción'},
			{'value' : AGRUPACION_MES, 'text' : 'Mes'},
			{'value' : AGRUPACION_BIMESTRE, 'text' : 'Bimestre'},
			{'value' : AGRUPACION_TRIMESTRE, 'text' : 'Trimestre'},
			{'value' : AGRUPACION_CUATRIMESTRE, 'text' : 'Cuatrimestre'},
			{'value' : AGRUPACION_SEMESTRE, 'text' : 'Semestre'},
			{'value' : AGRUPACION_ANUAL, 'text' : 'Anual'},
		];	

		mi.agrupacion = mi.agrupaciones[0];
		
		mi.redireccionSinPermisos=function(){
			$window.location.href = '/main.jsp#!/forbidden';		
		}
	    
	    mi.reiniciarVista=function(){
			if($location.path()=='/informacionPresupuestaria/rv')
				$route.reload();
			else
				$location.path('/informacionPresupuestaria/rv');
		}
	    
		mi.formatofecha = 'yyyy';
		
		mi.prestamos = [
			{'value' : 0, 'text' : 'Seleccionar una opción'},
		];
		
		mi.prestamo = mi.prestamos[0];
		
		mi.abrirPopupFecha = function(index) {
			switch(index){
				case 1000: mi.fi_abierto = true; break;
				case 1001: mi.ff_abierto = true; break;
			}
		};
		
		mi.fechaOptions = {
				formatYear: 'yyyy',
			    startingDay: 1,
			    minMode: 'year'
		};
		
		mi.getPrestamos = function(){
			$http.post('/SProyecto',{accion: 'getProyectos'}).success(
				function(response) {
					mi.prestamos = [];
					mi.prestamos.push({'value' : 0, 'text' : 'Seleccione una opción'});
					if (response.success){
						for (var i = 0; i < response.entidades.length; i++){
							mi.prestamos.push({'value': response.entidades[i].id, 'text': response.entidades[i].nombre});
						}
						mi.prestamo = mi.prestamos[0];
					}
				});
		}
		
		mi.generarTabla = function(){
			mi.columnas = [];
			mi.columnaNames = [];
			mi.cabeceras = [];
			mi.categorias = [];
			mi.columnasDinamicas = [];
			
			var fecha = new Date();
			var m = fecha.getMonth() +1;
			var y = fecha.getFullYear();
			
			var i = 0;
			var j = 0;
			var mesName = "";
			mi.columnas.push({ name: 'nombre', pinnedLeft:true, enableCellEdit: false, width: 300, displayName: '', enableColumnMenu: false,
	        	cellTemplate: "<div class=\"ui-grid-cell-contents\" ng-class=\"{'ui-grid-tree-padre': row.hijo.length != 0}\"><div class=\"ui-grid-cell-contents\" title=\"TOOLTIP\"><div style=\"float:left;\" class=\"ui-grid-tree-base-row-header-buttons\" ng-class=\"{'ui-grid-tree-base-header': row.treeLevel > -1 }\" ng-click=\"grid.appScope.controller.toggleRow(row,evt)\"><i ng-class=\"{'ui-grid-icon-down-dir': ( ( grid.options.showTreeExpandNoChildren && row.treeLevel > -1 ) || ( row.treeNode.children && row.treeNode.children.length > 0 ) ) && row.treeNode.state === 'expanded', 'ui-grid-icon-right-dir': ( ( grid.options.showTreeExpandNoChildren && row.treeLevel > -1 ) || ( row.treeNode.children && row.treeNode.children.length > 0 ) ) && row.treeNode.state === 'collapsed', 'ui-grid-icon-blank': ( ( !grid.options.showTreeExpandNoChildren && row.treeLevel > -1 ) && !( row.treeNode.children && row.treeNode.children.length > 0 ) )}\" ng-style=\"{'padding-left': grid.options.treeIndent * row.treeLevel + 'px'}\"></i> &nbsp;</div>{{COL_FIELD CUSTOM_FILTERS}}</div>",
	        	footerCellTemplate: '<div class="ui-grid-cell-contents">Total</div>',
	        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
	        		if(row.entity.hijos.length == 0)
	        			return "actividad";
	        		else
	        			return "padre";
	            }
	        });
			
			mi.columnaNames.push("nombre");
			mi.cabeceras.push("nombre");
			
			if(mi.agrupacion.value == AGRUPACION_MES){
				var fInicial = moment(mi.fechaInicio).format('YYYY');
				var fFinal = moment(mi.fechaFin).format('YYYY');
				
				for(j = fInicial; j <= fFinal; j++){
					mi.categorias.push({name: j.toString(), visible: true, showCatName: true});
					
					for(i = 1; i <= 12; i++){
						mesName = MES_NAME[i-1];
						
						mesDisplayName = MES_DISPLAY_NAME[i-1];
						
						mi.totales[mesName + "p"] = 0;
						mi.columnaNames.push(mesName + "p");
						mi.columnasDinamicas.push(mesName+ "p");
						mi.cabeceras.push(mesDisplayName);
						mi.columnas.push({ name: mesName + "p", enableCellEdit: false, width: 120, displayName: mesDisplayName, type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2',
				        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.getTotal(this) | number:2}}</div>', enableHiding: false, enableGrouping: false, enablePinning: false,
				        	menuItems: [
				        		{
				        			title: 'Mostrar/Ocultar',
				        			action: mi.mostrarOcultarColumna
				        		}
				        	],
				        	category: j.toString()
				        });
						
						mi.totales[mesName + "r"] = 0;
						mi.columnaNames.push(mesName + "r");
						mi.columnasDinamicas.push(mesName + "r");
						mi.cabeceras.push(mesDisplayName);
						mi.columnas.push({ name: mesName + "r", enableCellEdit: false, width: 120, displayName: mesDisplayName, type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2',
				        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.getTotal(this) | number:2}}</div>', enableHiding: false, enableGrouping: false, enablePinning: false,
				        	menuItems: [
				        		{
				        			title: 'Mostrar/Ocultar',
				        			action: mi.mostrarOcultarColumna
				        		}
				        	],
				        	category: j.toString(),
				        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
				                return "real";
				            }
				        });
					}
				}
			}else if (mi.agrupacion.value == AGRUPACION_BIMESTRE){
				var fInicial = moment(mi.fechaInicio).format('YYYY');
				var fFinal = moment(mi.fechaFin).format('YYYY');
				
				for(j = fInicial; j <= fFinal; j++){
					mi.categorias.push({name: j.toString(), visible: true, showCatName: true});
					
					for(i = 1; i <= 6; i++){
						mesName = BIMESTRE_NAME[i-1];
						
						mesDisplayName = BIMESTRE_DISPLAY_NAME[i-1];
						
						mi.totales[mesName + "-" + j + "-P"] = 0;
						mi.columnaNames.push(mesName + "-" + j + "-P");
						mi.columnasDinamicas.push(mesName+ "-" + j + "-P");
						mi.cabeceras.push(mesDisplayName);
						
						mi.columnas.push({ name: mesName + "-" + j + "-P", enableCellEdit: false, width: 120, displayName: mesDisplayName, type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2', 
				        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.getTotal(this) | number:2}}</div>', enableHiding: false, enableGrouping: false, enablePinning: false,
				        	menuItems: [
				        		{
				        			title: 'Mostrar/Ocultar',
				        			action: mi.mostrarOcultarColumna
				        		}
				        	],
				        	category: j.toString(),
				        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
				                return "planificado";
				            }
				        });
						
						mi.totales[mesName + "-" + j + "-R"] = 0;
						mi.columnaNames.push(mesName + "-" + j + "-R");
						mi.columnasDinamicas.push(mesName + "-" + j + "-R");
						mi.cabeceras.push(mesDisplayName);
						mi.columnas.push({ name: mesName + "-" + j + "-R", enableCellEdit: false, width: 120, displayName: mesDisplayName, type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2', 
				        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.getTotal(this) | number:2}}</div>', enableHiding: false, enableGrouping: false, enablePinning: false,
				        	menuItems: [
				        		{
				        			title: 'Mostrar/Ocultar',
				        			action: mi.mostrarOcultarColumna
				        		}
				        	],
				        	category: j.toString(),
				        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
				                return "real";
				            }
				        });
					}
				}
			}else if (mi.agrupacion.value == AGRUPACION_TRIMESTRE){
				var fInicial = moment(mi.fechaInicio).format('YYYY');
				var fFinal = moment(mi.fechaFin).format('YYYY');
				
				for(j = fInicial; j <= fFinal; j++){
					mi.categorias.push({name: j.toString(), visible: true, showCatName: true});
					
					for(i = 1; i <= 4; i++){
						mesName = TRIMESTRE_NAME[i-1];
						
						mesDisplayName = TRIMESTRE_DISPLAY_NAME[i-1];
						
						mi.totales[mesName + "-" + j + "-P"] = 0;
						mi.columnaNames.push(mesName + "-" + j + "-P");
						mi.columnasDinamicas.push(mesName+ "-" + j + "-P");
						mi.cabeceras.push(mesDisplayName);
						
						mi.columnas.push({ name: mesName + "-" + j + "-P", enableCellEdit: false, width: 120, displayName: mesDisplayName, type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2', 
				        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.getTotal(this) | number:2}}</div>', enableHiding: false, enableGrouping: false, enablePinning: false,
				        	menuItems: [
				        		{
				        			title: 'Mostrar/Ocultar',
				        			action: mi.mostrarOcultarColumna
				        		}
				        	],
				        	category: j.toString(),
				        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
				                return "planificado";
				            }
				        });
						
						mi.totales[mesName + "-" + j + "-R"] = 0;
						mi.columnaNames.push(mesName + "-" + j + "-R");
						mi.columnasDinamicas.push(mesName + "-" + j + "-R");
						mi.cabeceras.push(mesDisplayName);
						mi.columnas.push({ name: mesName + "-" + j + "-R", enableCellEdit: false, width: 120, displayName: mesDisplayName, type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2', 
				        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.getTotal(this) | number:2}}</div>', enableHiding: false, enableGrouping: false, enablePinning: false,
				        	menuItems: [
				        		{
				        			title: 'Mostrar/Ocultar',
				        			action: mi.mostrarOcultarColumna
				        		}
				        	],
				        	category: j.toString(),
				        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
				                return "real";
				            }
				        });
					}
				}
			}else if (mi.agrupacion.value == AGRUPACION_CUATRIMESTRE){
				var fInicial = moment(mi.fechaInicio).format('YYYY');
				var fFinal = moment(mi.fechaFin).format('YYYY');
				
				for(j = fInicial; j <= fFinal; j++){
					mi.categorias.push({name: j.toString(), visible: true, showCatName: true});
					
					for(i = 1; i <= 3; i++){
						mesName = CUATRIMESTRE_NAME[i-1];
						
						mesDisplayName = CUATRIMESTRE_DISPLAY_NAME[i-1];
						
						mi.totales[mesName + "-" + j + "-P"] = 0;
						mi.columnaNames.push(mesName + "-" + j + "-P");
						mi.columnasDinamicas.push(mesName+ "-" + j + "-P");
						mi.cabeceras.push(mesDisplayName);
						
						mi.columnas.push({ name: mesName + "-" + j + "-P", enableCellEdit: false, width: 130, displayName: mesDisplayName, type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2', 
				        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.getTotal(this) | number:2}}</div>', enableHiding: false, enableGrouping: false, enablePinning: false,
				        	menuItems: [
				        		{
				        			title: 'Mostrar/Ocultar',
				        			action: mi.mostrarOcultarColumna
				        		}
				        	],
				        	category: j.toString(),
				        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
				                return "planificado";
				            }
				        });
						
						mi.totales[mesName + "-" + j + "-R"] = 0;
						mi.columnaNames.push(mesName + "-" + j + "-R");
						mi.columnasDinamicas.push(mesName + "-" + j + "-R");
						mi.cabeceras.push(mesDisplayName);
						mi.columnas.push({ name: mesName + "-" + j + "-R", enableCellEdit: false, width: 130, displayName: mesDisplayName, type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2', 
				        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.getTotal(this) | number:2}}</div>', enableHiding: false, enableGrouping: false, enablePinning: false,
				        	menuItems: [
				        		{
				        			title: 'Mostrar/Ocultar',
				        			action: mi.mostrarOcultarColumna
				        		}
				        	],
				        	category: j.toString(),
				        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
				                return "real";
				            }
				        });
					}
				}
			}else if (mi.agrupacion.value == AGRUPACION_SEMESTRE){
				var fInicial = moment(mi.fechaInicio).format('YYYY');
				var fFinal = moment(mi.fechaFin).format('YYYY');
				
				for(j = fInicial; j <= fFinal; j++){
					mi.categorias.push({name: j.toString(), visible: true, showCatName: true});
					
					for(i = 1; i <= 2; i++){
						mesName = SEMESTRE_NAME[i-1];
						
						mesDisplayName = SEMESTRE_DISPLAY_NAME[i-1];
						
						mi.totales[mesName + "-" + j + "-P"] = 0;
						mi.columnaNames.push(mesName + "-" + j + "-P");
						mi.columnasDinamicas.push(mesName+ "-" + j + "-P");
						mi.cabeceras.push(mesDisplayName);
						
						mi.columnas.push({ name: mesName + "-" + j + "-P", enableCellEdit: false, width: 120, displayName: mesDisplayName, type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2', 
				        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.getTotal(this) | number:2}}</div>', enableHiding: false, enableGrouping: false, enablePinning: false,
				        	menuItems: [
				        		{
				        			title: 'Mostrar/Ocultar',
				        			action: mi.mostrarOcultarColumna
				        		}
				        	],
				        	category: j.toString(),
				        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
				                return "planificado";
				            }
				        });
						
						mi.totales[mesName + "-" + j + "-R"] = 0;
						mi.columnaNames.push(mesName + "-" + j + "-R");
						mi.columnasDinamicas.push(mesName + "-" + j + "-R");
						mi.cabeceras.push(mesDisplayName);
						mi.columnas.push({ name: mesName + "-" + j + "-R", enableCellEdit: false, width: 120, displayName: mesDisplayName, type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2', 
				        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.getTotal(this) | number:2}}</div>', enableHiding: false, enableGrouping: false, enablePinning: false,
				        	menuItems: [
				        		{
				        			title: 'Mostrar/Ocultar',
				        			action: mi.mostrarOcultarColumna
				        		}
				        	],
				        	category: j.toString(),
				        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
				                return "real";
				            }
				        });
					}
				}
			}else if (mi.agrupacion.value == AGRUPACION_ANUAL){
				var fInicial = moment(mi.fechaInicio).format('YYYY');
				var fFinal = moment(mi.fechaFin).format('YYYY');
				
				for(j = fInicial; j <= fFinal; j++){
					mesName = "Anio";
					
					mesDisplayName = "Año " + j;
					
					mi.totales[mesName + "-" + j + "-P"] = 0;
					mi.columnaNames.push(mesName + "-" + j + "-P");
					mi.columnasDinamicas.push(mesName+ "-" + j + "-P");
					mi.cabeceras.push(mesDisplayName);
					
					mi.columnas.push({ name: mesName + "-" + j + "-P", enableCellEdit: false, width: 120, displayName: mesDisplayName, type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2', 
			        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.getTotal(this) | number:2}}</div>', enableHiding: false, enableGrouping: false, enablePinning: false,
			        	menuItems: [
			        		{
			        			title: 'Mostrar/Ocultar',
			        			action: mi.mostrarOcultarColumna
			        		}
			        	],
			        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
			                return "planificado";
			            }
			        });
					
					mi.totales[mesName + "-" + j + "-R"] = 0;
					mi.columnaNames.push(mesName + "-" + j + "-R");
					mi.columnasDinamicas.push(mesName + "-" + j + "-R");
					mi.cabeceras.push(mesDisplayName);
					mi.columnas.push({ name: mesName + "-" + j + "-R", enableCellEdit: false, width: 120, displayName: mesDisplayName, type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2', 
			        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.getTotal(this) | number:2}}</div>', enableHiding: false, enableGrouping: false, enablePinning: false,
			        	menuItems: [
			        		{
			        			title: 'Mostrar/Ocultar',
			        			action: mi.mostrarOcultarColumna
			        		}
			        	],
			        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
			                return "real";
			            }
			        });
				}
			}
			
			mi.columnas.push({ name: 'Totalp', enableCellEdit: false, width: 150, displayName: 'Total general', type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2',
	        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.totalP | number:2}}</div>', pinnedRight:true, enableHiding: false, enableGrouping: false, enablePinning: false,
	        	menuItems: [
	        		{
	        			title: 'Mostrar/Ocultar',
	        			action: mi.mostrarOcultarColumna
	        		}
	        	],
	        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
	                return "planificadoTotal";
	            }
	        });
			
			mi.columnas.push({ name: 'Totalr', enableCellEdit: false, width: 150, displayName: 'Total general', type: 'number', cellFilter:'number:2', footerCellFilter : 'number : 2',
	        	footerCellTemplate: '<div class="ui-grid-cell-contents"> {{grid.appScope.controller.totalR | number:2}}</div>', pinnedRight:true, enableHiding: false, enableGrouping: false, enablePinning: false,
	        	menuItems: [
	        		{
	        			title: 'Mostrar/Ocultar',
	        			action: mi.mostrarOcultarColumna
	        		}
	        	],
	        	cellClass : function(grid, row, col, rowRenderIndex, colRenderIndex) {
	                return "realTotal";
	            }
	        });
			
			mi.columnaNames.push("Totalp");
			mi.cabeceras.push("Totalp");
			mi.columnaNames.push("Totalr");
			mi.cabeceras.push("Totalr");
			mi.gridOptions.columnDefs = mi.columnas;
			
			mi.mostrarPlanificado();
		}
		
		mi.mostrarReal = function(){
			var currentTime = new Date();
			var month = currentTime.getMonth() + 1;
			var year = currentTime.getFullYear();
			
			for(x in mi.gridOptions.columnDefs){
				if(x > 0){
					if(mi.gridOptions.columnDefs[x].name.includes("p")){
						mi.gridOptions.columnDefs[x].visible = false;
						mi.gridOptions.columnDefs[x].ocultar = true;
					}else{
						mi.gridOptions.columnDefs[x].visible = true;
						mi.gridOptions.columnDefs[x].ocultar = false;
					}
				}
			}
			
			mi.gridApi.core.notifyDataChange( uiGridConstants.dataChange.COLUMN);
		}
		
		mi.mostrarPlanificado = function(){
			var currentTime = new Date();
			var month = currentTime.getMonth() + 1;
			var year = currentTime.getFullYear();
			
			for(x in mi.gridOptions.columnDefs){
				if(x > 0){
					if(mi.gridOptions.columnDefs[x].name.includes("r")){
						mi.gridOptions.columnDefs[x].visible = false;
						mi.gridOptions.columnDefs[x].ocultar = true;
					}else{
						mi.gridOptions.columnDefs[x].visible = true;
						mi.gridOptions.columnDefs[x].ocultar = false;
					}
				}
			}
			
			mi.gridApi.core.notifyDataChange( uiGridConstants.dataChange.COLUMN);
		}
		
		mi.mostrarCombinado = function(){
			for(x in mi.gridOptions.columnDefs){
				mi.gridOptions.columnDefs[x].visible = true;
				mi.gridOptions.columnDefs[x].ocultar = false;
			}
			
			mi.gridApi.core.notifyDataChange( uiGridConstants.dataChange.COLUMN);
		}
		
		mi.getTotal = function(columna){
			return mi.totales[columna.col.name];
		}
		
		mi.mostrarOcultarColumna = function(col){
			var columna = this.context.col.name;
			var columna2 = "";
			var bandera = true;
			
			if (columna.includes("p")){
				columna2 = columna.replace('p','r');
			}else if (columna.includes("r")){
				columna2 = columna.replace('r','p');
			}
				
			for(x in mi.gridOptions.columnDefs){
				if(mi.gridOptions.columnDefs[x].name == columna){
					if(mi.gridOptions.columnDefs[x].ocultar){
						mi.gridOptions.columnDefs[x].visible = false;
						mi.gridApi.core.notifyDataChange( uiGridConstants.dataChange.COLUMN);
						bandera = false;
						break;
					}else
						break;
				}
			}
			
			if (bandera){
				for(x in mi.gridOptions.columnDefs){
					if(mi.gridOptions.columnDefs[x].name == columna2){
						mi.gridOptions.columnDefs[x].visible = true;
						mi.gridApi.core.notifyDataChange( uiGridConstants.dataChange.COLUMN);
					}
				}
			}
			
			mi.calcularTotales();
			mi.totalPrestamo();
		}
		
		mi.generar = function(){
			if(mi.prestamo.value > 0)
			{
				if(mi.fechaInicio != null && mi.fechaFin != null)
				{
					if (mi.fechaFin >= mi.fechaInicio){
						if(mi.agrupacion.value != 0){
							$scope.active = 0;
							mi.mostrarcargando=true;
							mi.generarTabla();
							
							$http.post('/SInformePresupuesto',{
								accion: 'generarInforme',
								idPrestamo: mi.prestamo.value,
								informeCompleto: mi.informeCompleto,
								columnaNames: mi.columnasDinamicas.toString(),
								agrupacion: mi.agrupacion.value,
								anoInicial: moment(mi.fechaInicio).format('YYYY'),
								anoFinal: moment(mi.fechaFin).format('YYYY')
							}).success(function(response){
								if (response.success){
									mi.crearArbol(response.prestamo);
									mi.data = response.prestamo;								
									mi.mostrarcargando=false;
								}else{
									if (response.prestamo[0].tipoInforme == 2){
										$utilidades.mensaje('warning','No existe informe para modificar');
									}
								}
								mi.mostrarDescargar = true;
							})
						}else
							$utilidades.mensaje('warning','Debe seleccionar la agrupación');
					}else
						$utilidades.mensaje('warning','La fecha inicial es mayor a la fecha final');
				}else
					$utilidades.mensaje('warning','Debe seleccionar un año');
			}else
				$utilidades.mensaje('warning','Debe de seleccionar un préstamo');
		}
		
		mi.exportarExcel = function(){
		    var reporte = []; 

			var obj = {};
			for(x in mi.gridOptions.data){
				for (y in mi.columnaNames){
					obj[mi.columnaNames[y]] = mi.gridOptions.data[x][mi.columnaNames[y]];
				}
				
				reporte.push(obj);
				obj = {};
			}
			
			for(y in mi.columnaNames){
				if(y == 0)
					obj[mi.columnaNames[y]] = "Total";
				else if (y == mi.columnaNames.length-1)
					obj[mi.columnaNames[y]] = mi.totalP;
				else
					obj[mi.columnaNames[y]] = mi.totales[mi.columnaNames[y]];
			}
			
			reporte.push(obj);
			
			$http.post('/SInformePresupuesto',{
				accion: 'exportarExcel',
				data: JSON.stringify(reporte),
				idPrestamo: mi.prestamo.value,
				anio: moment(mi.fechaInicio).format('DD/MM/YYYY'),
				columnas: mi.columnaNames.toString(),
				cabeceras : mi.cabeceras.toString(),
				t:moment().unix()
			}).then(
			  function successCallback(response) {
					var anchor = angular.element('<a/>');
				    anchor.attr({
				         href: 'data:application/ms-excel;base64,' + response.data,
				         target: '_blank',
				         download: 'Informe.xls'
				     })[0].click();
				  }.bind(this), function errorCallback(response){
				 		
				 	}
				 );
		}
		
		mi.crearArbol = function(datos){
			if (datos.length > 0){
				mi.gridOptions.data = datos;
				
				$timeout(function(){
				     mi.gridApi.treeBase.expandAllRows();
				     mi.totalPrestamo();
				     mi.calcularTotales();
			   })
			}
		}
		
		mi.ddlOpciones = [{ id: 1, value: 'Comienzo' },
            { id: 2, value: 'Prorrateo' },
            { id: 3, value: 'Fin' }];
		
		mi.gridOptions = {
				showColumnFooter: true,
	            cellEditableCondition:function($scope){
	            	  if($scope.row.entity.objetoTipo == 5 && $scope.row.entity.hijos.length == 0)
	            		  return true;
	            	  else
	            		  return false;
	            },
	            headerTemplate: '<div role="rowgroup" class="ui-grid-header"> <div class="ui-grid-top-panel"> <div class="ui-grid-header-viewport"> <div class="ui-grid-header-canvas"> <div align="center" class="ui-grid-header-cell-wrapper" ng-style="colContainer.headerCellWrapperStyle()"> <div role="row" class="ui-grid-header-cell-row"><div align="center" class="ui-grid-header-cell ui-grid-clearfix ui-grid-category" ng-repeat="cat in grid.appScope.controller.categorias" ng-if="cat.visible && (colContainer.renderedColumns | filter:{ colDef:{category: cat.name} }).length > 0"> <span ng-if="cat.showCatName === true"> {{cat.name}} </span> <br ng-if="cat.showCatName !== true" />  <div class="ui-grid-header-cell ui-grid-clearfix" ng-repeat="col in colContainer.renderedColumns | filter:{ colDef:{category: cat.name} }" ui-grid-header-cell col="col" render-index="$index"> </div> </div><!--!cat.visible && --> <div class="ui-grid-header-cell ui-grid-clearfix" ng-if="col.colDef.category === undefined" ng-repeat="col in colContainer.renderedColumns track by col.uid" ui-grid-header-cell col="col" render-index="$index"> </div> </div> </div> </div> </div> </div> </div>',
	            category: mi.categorias,
				rowEditWaitInterval: -1,
				expandAllRows : true,
				enableExpandableRowHeader: false,
				showTreeRowHeader: false,
				showTreeExpandNoChildren : false,
				enableSorting: false,
			    columnDefs: mi.columnas,
			    onRegisterApi: function(gridApi ) {
			      mi.gridApi = gridApi;
			  }
		};
		
		mi.toggleRow = function(row, evt) {
			uiGridTreeBaseService.toggleRowTreeState(mi.gridApi.grid, row, evt);
		};
		
		mi.totalPrestamo = function(){
			mi.rowEntity = mi.gridOptions.data[0];
			mi.totalP = 0;
			mi.totalR = 0;
			var columna = "";
			for(x in mi.columnasDinamicas){
				if(mi.columnasDinamicas[x].includes("p")==true){
					columna = mi.columnasDinamicas[x];
					mi.totalP += mi.obtenerValor(mi.rowEntity,columna);
				}else if(mi.columnasDinamicas[x].includes("r")==true){
					columna = mi.columnasDinamicas[x];
					mi.totalR += mi.obtenerValor(mi.rowEntity,columna);
				}
			}
			
			for(x in mi.columnasDinamicas){
				if(mi.columnasDinamicas[x].includes("p")==true){
					columna = mi.columnasDinamicas[x];
					mi.totales[columna] = mi.rowEntity[columna];
				}else if(mi.columnasDinamicas[x].includes("r")==true){
					columna = mi.columnasDinamicas[x];
					mi.totales[columna] = mi.rowEntity[columna];
				}
			}
		}
		
		mi.calcularTotales = function(){
			var montoPlanificado = 0;
			var montoReal = 0;
			
			for(x in mi.gridOptions.data){
				var rowEntity = mi.obtenerEntidad(mi.gridOptions.data[x].idObjetoTipo, mi.gridOptions.data[x].objetoTipo);
				
				for(y in mi.columnasDinamicas){
					if(mi.columnasDinamicas[y].includes("p")==true){
						montoPlanificado += mi.obtenerValor(rowEntity, mi.columnasDinamicas[y]);
					}else if(mi.columnasDinamicas[y].includes("r")==true){
						montoReal+= mi.obtenerValor(rowEntity, mi.columnasDinamicas[y]);
					}
				}
				
				rowEntity["Totalp"] = montoPlanificado;
				rowEntity["Totalr"] = montoReal;
				montoPlanificado = 0;
				montoReal = 0;
			}
		}
		
		mi.obtenerEntidad = function(id, objetoTipo){
			for (x in mi.data){
				if (id == mi.data[x].idObjetoTipo && objetoTipo == mi.data[x].objetoTipo){
					return mi.data[x];
				}
			}
		}
		
		mi.obtenerValor = function(rowEntidad, columna){
			return rowEntidad[columna];
		}
		
		mi.getPrestamos();
}])

.filter('mapAcumulacionCosto', function() {
	  var genderHash = {
	    1: 'Comienzo',
	    2: 'Prorrateo',
	    3: 'Fin'
	  };
	 
	  return function(input) {
	    if (!input){
	      return '';
	    } else {
	      return genderHash[input];
	    }
	  };
	})
=======
var app = angular.module('informacionPresupuestariaController',['ngAnimate', 'ngTouch', 'ui.grid.edit', 'ui.grid.rowEdit', 'smart-table']);

app.controller('adquisicionesController', ['$scope', '$http', '$interval', 'uiGridTreeViewConstants','Utilidades','i18nService','uiGridConstants','$timeout', 'uiGridTreeBaseService', '$q','dialogoConfirmacion',
	function($scope, $http, $interval, uiGridTreeViewConstants,$utilidades,i18nService,uiGridConstants,$timeout, uiGridTreeBaseService, $q, $dialogoConfirmacion){
		var mi = this;
		i18nService.setCurrentLang('es');
		mi.fechaInicio = "";
		mi.fechaFin = "";
		mi.movimiento = false;
		mi.mostrarDescargar = false;
		mi.mostrarCargando = false;
		mi.SiguienteActivo = true;
		mi.AnteriorActivo = false;
		mi.enMillones = true;
		mi.agrupacionActual = 1
		mi.limiteAnios = 5;
		mi.tamanioMinimoColumna = 125;
		mi.tamanioMinimoColumnaMillones = 75;
		mi.grupoMostrado= {"planificado":true,"real":true};
		mi.estiloAlineacion="text-align: center;";
		
		var AGRUPACION_MES= 1;
		var AGRUPACION_BIMESTRE = 2;
		var AGRUPACION_TRIMESTRE = 3;
		var AGRUPACION_CUATRIMESTRE= 4;
		var AGRUPACION_SEMESTRE= 5;
		var AGRUPACION_ANUAL= 6;
		
		var MES_DISPLAY_NAME = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
		var BIMESTRE_DISPLAY_NAME = ['Bimestre 1', 'Bimestre 2','Bimestre 3','Bimestre 4','Bimestre 5','Bimestre 6'];
		var TRIMESTRE_DISPLAY_NAME = ['Trimestre 1', 'Trimestre 2', 'Trimestre 3', 'Trimestre 4'];
		var CUATRIMESTRE_DISPLAY_NAME = ['Cuatrimestre 1', 'Cuatrimestre 2', 'Cuatrimestre 3'];
		var SEMESTRE_DISPLAY_NAME = ['Semestre 1','Semestre 2'];
		var ANUAL_DISPLAY_NAME = ['Anual'];
		
		//**TODO: quitar generación dinamica de informacion
		//////////////////////**************************************************
		
		$scope.divActivo = "";
		mi.activarScroll = function(id){
			$scope.divActivo = id;
	    }
		
		var nameList = ['Pierre', 'Pol', 'Jacques', 'Robert', 'Elisa', 'Dupont', 'Germain', 'Delcourt', 'Erick', 'Menez'];
        
        $scope.rowCollection = [];
        $scope.datosTabla = [];
        
        function createRandomItem() {
            var
                firstName = Math.floor(Math.random() * 1000000000),
                lastName = Math.floor(Math.random() * 1000000000),
                age = Math.floor(Math.random() * 1000000000),
                email = Math.floor(Math.random() * 1000000000),
                balance = Math.floor(Math.random() * 1000000000),
            	nombre = nameList[Math.floor(Math.random() * 9)];

            return {
                1: lastName,
                2: age,
                3: email,
                4: balance,
                5: lastName,
                6: age,
                7: email,
                8: balance,
                9: lastName,
                10: age,
                11: email,
                12: balance,
                13: lastName,
                14: age,
                15: email,
                16: balance,
                17: lastName,
                18: age,
                19: email,
                20: balance,
                21: lastName,
                22: age,
                23: email,
                24: balance,
                25: lastName,
                26: age,
                27: email,
                28: balance,
                29: lastName,
                30: age,
                31: email,
                32: balance,
                33: lastName,
                34: age,
                35: email,
                36: email,
                nombre: nombre
            };
        }
        
        $scope.columns=['1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36'];
                
        //**************************************************////////////////////
		
		mi.agrupaciones = [
			{'value' : 0, 'text' : 'Seleccione una opción'},
			{'value' : AGRUPACION_MES, 'text' : 'Mensual'},
			{'value' : AGRUPACION_BIMESTRE, 'text' : 'Bimestre'},
			{'value' : AGRUPACION_TRIMESTRE, 'text' : 'Trimestre'},
			{'value' : AGRUPACION_CUATRIMESTRE, 'text' : 'Cuatrimestre'},
			{'value' : AGRUPACION_SEMESTRE, 'text' : 'Semestre'},
			{'value' : AGRUPACION_ANUAL, 'text' : 'Anual'},
		];	

		mi.agrupacion = mi.agrupaciones[0];
		
		mi.redireccionSinPermisos=function(){
			$window.location.href = '/main.jsp#!/forbidden';		
		}
	    
	    mi.reiniciarVista=function(){
			if($location.path()=='/informacionPresupuestaria/rv')
				$route.reload();
			else
				$location.path('/informacionPresupuestaria/rv');
		}
	    
		mi.formatofecha = 'yyyy';
		
		mi.prestamos = [
			{'value' : 0, 'text' : 'Seleccionar una opción'},
		];
		
		mi.prestamo = mi.prestamos[0];
		
		mi.abrirPopupFecha = function(index) {
			switch(index){
				case 1000: mi.fi_abierto = true; break;
				case 1001: mi.ff_abierto = true; break;
			}
		};
		
		mi.fechaOptions = {
				formatYear: 'yyyy',
			    startingDay: 1,
			    minMode: 'year'
		};
		
		$http.post('/SProyecto',{accion: 'getProyectos'}).success(
			function(response) {
				mi.prestamos = [];
				mi.prestamos.push({'value' : 0, 'text' : 'Seleccione una opción'});
				if (response.success){
					for (var i = 0; i < response.entidades.length; i++){
						mi.prestamos.push({'value': response.entidades[i].id, 'text': response.entidades[i].nombre});
					}
					mi.prestamo = mi.prestamos[0];
				}
		});
				
		mi.anterior = function(){
			var elemento = document.getElementById("divTablaDatos");
			if(mi.totalCabecerasAMostrar == 0){
				elemento.scrollLeft -= mi.tamanoCelda;
				document.getElementById("divCabecerasDatos").scrollLeft -= mi.tamanoCelda;
				mi.SiguienteActivo = true;
			}else{
				if(elemento.scrollLeft > 0){
					elemento.scrollLeft -= mi.tamanoCabecera;
					document.getElementById("divCabecerasDatos").scrollLeft -= mi.tamanoCabecera;
					mi.SiguienteActivo = true;
					if(elemento.scrollLeft <= 0){
						mi.AnteriorActivo = false;
					}
				}
			}
		}
		
		mi.siguiente = function(){
			var elemento = document.getElementById("divTablaDatos");
			if(mi.totalCabecerasAMostrar == 0){
				elemento.scrollLeft += mi.tamanoCelda;
				document.getElementById("divCabecerasDatos").scrollLeft += mi.tamanoCelda;
				mi.AnteriorActivo = true;
			}else{
				if(elemento.scrollLeft < ((mi.tamanoCabecera * (mi.totalCabeceras - mi.totalCabecerasAMostrar)))){
					elemento.scrollLeft += mi.tamanoCabecera;
					document.getElementById("divCabecerasDatos").scrollLeft += mi.tamanoCabecera;
					mi.AnteriorActivo = true;
					if(elemento.scrollLeft >= ((mi.tamanoCabecera * (mi.totalCabeceras - mi.totalCabecerasAMostrar)))){
						mi.SiguienteActivo = false;
					}
				}
			}
		}
		
		mi.validar = function(noElemento){
			if(mi.prestamo.value > 0)
			{
				if(mi.fechaInicio != null && mi.fechaInicio.toString().length == 4 && 
						mi.fechaFin != null && mi.fechaFin.toString().length == 4)
				{
					if (mi.fechaFin >= mi.fechaInicio){
						if(noElemento && noElemento == 2 && (mi.fechaFin - mi.fechaInicio)>mi.limiteAnios){ //fechaInicio
							mi.fechaInicio = mi.fechaFin - mi.limiteAnios;
							$utilidades.mensaje('warning','La diferencia de años no puede ser mayor a '+mi.limiteAnios);
						}else if(noElemento && noElemento == 3 && (mi.fechaFin - mi.fechaInicio)>mi.limiteAnios){ //fechaFin
							mi.fechaFin = mi.fechaInicio + mi.limiteAnios;
							$utilidades.mensaje('warning','La diferencia de años no puede ser mayor a '+mi.limiteAnios);
						}
						mi.generar(mi.agrupacionActual);
					}else{
						$utilidades.mensaje('warning','La fecha inicial es mayor a la fecha final');
					}
				}
			}
		}
		
		mi.verificaSeleccionTipo = function(tipo){
			mi.mostrarCargando = true;
			if(mi.grupoMostrado.planificado && mi.grupoMostrado.real){
				mi.estiloAlineacion="text-align: center;";
			}else{
				mi.estiloAlineacion="text-align: right; padding-right:15px;";
			}
			if(!mi.grupoMostrado.planificado && !mi.grupoMostrado.real){
				if(tipo==1){
					mi.grupoMostrado.real = true;
				}else{
					mi.grupoMostrado.planificado = true;
				}
			}
			mi.calcularTamaniosCeldas();
			mi.mostrarCargando = false;
		}
				
		mi.calcularTamaniosCeldas = function(){
			var tamanioMinimo = mi.tamanioMinimoColumna;
			if(mi.enMillones){
				tamanioMinimo = mi.tamanioMinimoColumnaMillones;
			}
			if(mi.grupoMostrado.planificado && mi.grupoMostrado.real){
				tamanioMinimo = tamanioMinimo * 2;
			}
			mi.tamanoPantalla = Math.floor(document.getElementById("reporte").offsetWidth) - 200;
			mi.totalAnios = Number(mi.fechaFin) - Number(mi.fechaInicio) + 1;
			mi.totalCabecerasAMostrar = $utilidades.getCantidadCabecerasReporte(mi.tamanoPantalla, mi.totalAnios, mi.totalCabeceras, tamanioMinimo);
			if(mi.totalCabecerasAMostrar == 0){
				mi.tamanoCelda = tamanioMinimo;
				mi.tamanoTotal = mi.tamanoPantalla - (mi.tamanoCelda * (mi.totalAnios + 1));
				if(mi.tamanoTotal<0){mi.tamanoTotal=0;}
			}else{
				mi.tamanoCelda = $utilidades.getTamanioColumnaReporte(mi.tamanoPantalla, mi.totalAnios, mi.totalCabecerasAMostrar);
				mi.tamanoTotal = mi.totalCabecerasAMostrar * mi.totalAnios * mi.tamanoCelda;
			}
			mi.estiloCelda = "width:"+ mi.tamanoCelda + "px;min-width:"+ mi.tamanoCelda + "px; max-width:"+ mi.tamanoCelda + "px;";
			mi.tamanoCabecera = mi.totalAnios * mi.tamanoCelda;
			mi.estiloCabecera = "width:"+ mi.tamanoCabecera + "px;min-width:" + mi.tamanoCabecera +"px; max-width:"+ mi.tamanoCabecera + "px; text-align: center;";
		}
		
		mi.generar = function(agrupacion){
			if(mi.prestamo.value > 0)
			{
				if(mi.fechaInicio != null && mi.fechaFin != null)
				{
					if (mi.fechaFin >= mi.fechaInicio){
						if(agrupacion != 0){
							//**TODO: mostrar Cargando
							//mi.mostrarCargando = true;
							mi.agrupacionActual = agrupacion;
							mi.totalCabeceras = 1;
							switch (agrupacion) {
							case 1: mi.totalCabeceras = 12; break;
							case 2: mi.totalCabeceras = 6; break;
							case 3: mi.totalCabeceras = 4; break;
							case 4: mi.totalCabeceras = 3; break;
							case 5: mi.totalCabeceras = 2; break;
							case 6: mi.totalCabeceras = 1; break;
							}
							
							mi.calcularTamaniosCeldas();
							
							mi.anios = [];
							for(var i = mi.fechaInicio; i <= mi.fechaFin; i++){
								mi.anios.push({ano: i});
							}
							mi.colspan = mi.anios.length;
							mi.aniosfinales = [];
							
							mi.columnas = [];
							if(agrupacion == AGRUPACION_MES){
								for(var i = 0; i < mi.totalCabeceras; i++){
									mi.columnas.push({nombreMes: MES_DISPLAY_NAME[i]});
								}
							}else if(agrupacion == AGRUPACION_BIMESTRE){
								for(var i = 0; i < mi.totalCabeceras; i++){
									mi.columnas.push({nombreMes: BIMESTRE_DISPLAY_NAME[i]});
								}
							}else if(agrupacion == AGRUPACION_TRIMESTRE){
								for(var i = 0; i < mi.totalCabeceras; i++){
									mi.columnas.push({nombreMes: TRIMESTRE_DISPLAY_NAME[i]});
								}
							}else if(agrupacion == AGRUPACION_CUATRIMESTRE){
								for(var i = 0; i < mi.totalCabeceras; i++){
									mi.columnas.push({nombreMes: CUATRIMESTRE_DISPLAY_NAME[i]});
								}
							}else if(agrupacion == AGRUPACION_SEMESTRE){
								for(var i = 0; i < mi.totalCabeceras; i++){
									mi.columnas.push({nombreMes: SEMESTRE_DISPLAY_NAME[i]});
								}
							}else if(agrupacion == AGRUPACION_ANUAL){
								for(var i = 0; i < mi.totalCabeceras; i++){
									mi.columnas.push({nombreMes: ANUAL_DISPLAY_NAME[i]});
								}
							}
							
							mi.objetoMostrar = [];
							for(var i =0; i < mi.columnas.length; i++){
								mi.objetoMostrar.push(mi.columnas[i]);
							}
							
							mi.aniosfinales = [];
							for(var i = 0; i < mi.columnas.length; i++){
								for(var j = 0; j < mi.anios.length; j++){
									mi.aniosfinales.push({ano: mi.anios[j].ano});
								}
							}
							
							mi.aniosTotal = [];
							for(var j = 0; j < mi.anios.length; j++){
								mi.aniosTotal.push({ano: mi.anios[j].ano});
							}
							
							
							//**TODO: quitar generación dinamica de informacion							
							//////////////////****************************
							
							mi.mostrarDescargar = true;
							mi.movimiento = true;
							$scope.rowCollection = [];
							for(var i=0;i<50;i++){
								$scope.rowCollection.push(createRandomItem());
						    }
							$scope.datosTabla = [].concat($scope.rowCollection);
							//****************************/////////////////////
							
							var elemento = document.getElementById("divTablaDatos");
							if(elemento.scrollLeft >= ((mi.tamanoCabecera * (mi.totalCabeceras - mi.totalCabecerasAMostrar)))){
								mi.SiguienteActivo = false;
							}else{
								mi.SiguienteActivo = true;
							}
						}
					}else
						$utilidades.mensaje('warning','La fecha inicial es mayor a la fecha final');
				}else
					$utilidades.mensaje('warning','Favor de ingresar un año inicial y final válido');
			}else
				$utilidades.mensaje('warning','Debe de seleccionar un préstamo');
		}
}]);

app.directive('scrollespejo', ['$window', function($window) {
    return {
        restrict: 'A',
        link: function(scope, element, attrs) {
            element.bind('scroll', function() {
                var elemento = element[0];
                if (elemento.id == scope.divActivo){
      	          if(elemento.id == 'divTablaNombres'){
      	            document.getElementById("divTablaDatos").scrollTop = elemento.scrollTop ;
      	            document.getElementById("divTotales").scrollTop = elemento.scrollTop ;
      	          }else if(elemento.id == 'divTablaDatos'){
      	            document.getElementById("divTablaNombres").scrollTop = elemento.scrollTop ;
      	            document.getElementById("divTotales").scrollTop = elemento.scrollTop ;
      	          }else{
      	            document.getElementById("divTablaNombres").scrollTop = elemento.scrollTop ;
      	            document.getElementById("divTablaDatos").scrollTop = elemento.scrollTop ;
      	          }
      	        }
            });
            angular.element($window).bind('resize', function(){ 
                scope.controller.calcularTamaniosCeldas();
                scope.$digest();
              });
            scope.$on('$destroy', function () { window.angular.element($window).off('resize');});
        }
    };
}])

;
>>>>>>> VisualReporteMetas
